<!DOCTYPE html>
<html>
<head>
    <title>音频调试页面</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        #audioPlayer { width: 100%; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>🎵 GitHub Pages 音频文件调试工具</h1>
    
    <div class="test-result">
        <strong>音频文件URL:</strong> <span id="audioUrl">https://trashbeatgod.github.io/MySite/music/backgroundmusic.mp3</span>
    </div>
    
    <button onclick="testAudioLoad()">测试音频加载</button>
    <button onclick="testDirectDownload()">测试直接下载</button>
    <button onclick="checkCORS()">检查CORS</button>
    <button onclick="checkFileSize()">检查文件大小</button>
    
    <div id="results"></div>
    
    <h3>音频播放器测试:</h3>
    <audio id="audioPlayer" controls></audio>
    
    <h3>控制台日志:</h3>
    <div id="consoleLog" style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap;"></div>

    <script>
        const audioUrl = 'https://trashbeatgod.github.io/MySite/music/backgroundmusic.mp3';
        const resultsDiv = document.getElementById('results');
        const consoleLog = document.getElementById('consoleLog');
        const audioPlayer = document.getElementById('audioPlayer');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            consoleLog.textContent += logEntry;
            console.log(message);
        }

        function showResult(message, type) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            resultsDiv.appendChild(div);
            log(message, type);
        }

        async function testAudioLoad() {
            resultsDiv.innerHTML = '';
            consoleLog.textContent = '';
            
            log('开始音频加载测试...');
            
            try {
                const audio = new Audio();
                audio.src = audioUrl;
                
                audio.addEventListener('loadstart', () => {
                    log('音频开始加载...');
                });
                
                audio.addEventListener('loadedmetadata', () => {
                    log(`元数据加载成功: 时长=${audio.duration}秒`);
                    showResult(`✅ 元数据加载成功！音频时长: ${Math.round(audio.duration)}秒`, 'success');
                });
                
                audio.addEventListener('canplaythrough', () => {
                    log('音频可以完整播放');
                    showResult('✅ 音频可以完整播放！', 'success');
                });
                
                audio.addEventListener('error', (e) => {
                    log(`音频加载错误: ${audio.error.code} - ${audio.error.message}`);
                    showResult(`❌ 音频加载错误: ${getErrorMessage(audio.error.code)}`, 'error');
                });
                
                audio.load();
                
                // 设置播放器源
                audioPlayer.src = audioUrl;
                
            } catch (error) {
                log(`测试异常: ${error.message}`);
                showResult(`❌ 测试异常: ${error.message}`, 'error');
            }
        }

        async function testDirectDownload() {
            log('测试直接下载音频文件...');
            
            try {
                const response = await fetch(audioUrl, { method: 'HEAD' });
                
                if (response.ok) {
                    const contentLength = response.headers.get('content-length');
                    const contentType = response.headers.get('content-type');
                    const lastModified = response.headers.get('last-modified');
                    
                    log(`文件大小: ${contentLength} bytes`);
                    log(`内容类型: ${contentType}`);
                    log(`最后修改: ${lastModified}`);
                    
                    showResult(`✅ 文件可访问！<br>
                        大小: ${(contentLength / 1024 / 1024).toFixed(2)} MB<br>
                        类型: ${contentType}<br>
                        修改时间: ${lastModified}`, 'success');
                } else {
                    log(`HTTP错误: ${response.status} ${response.statusText}`);
                    showResult(`❌ HTTP错误: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                log(`下载错误: ${error.message}`);
                showResult(`❌ 下载错误: ${error.message}`, 'error');
            }
        }

        async function checkCORS() {
            log('检查CORS设置...');
            
            try {
                const response = await fetch(audioUrl, { 
                    method: 'GET',
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                const corsHeaders = [];
                for (let [key, value] of response.headers.entries()) {
                    if (key.toLowerCase().includes('access-control')) {
                        corsHeaders.push(`${key}: ${value}`);
                    }
                }
                
                if (corsHeaders.length > 0) {
                    log(`CORS头信息: ${corsHeaders.join(', ')}`);
                    showResult(`✅ CORS配置正常<br>${corsHeaders.join('<br>')}`, 'success');
                } else {
                    log('未找到CORS头信息，但这在GitHub Pages上是正常的');
                    showResult('ℹ️ 未找到CORS头信息，GitHub Pages通常不需要特殊CORS配置', 'warning');
                }
                
            } catch (error) {
                log(`CORS检查错误: ${error.message}`);
                showResult(`❌ CORS检查错误: ${error.message}`, 'error');
            }
        }

        async function checkFileSize() {
            log('检查GitHub上的文件大小...');
            
            try {
                const response = await fetch(audioUrl, { method: 'HEAD' });
                
                if (response.ok) {
                    const contentLength = response.headers.get('content-length');
                    const sizeInMB = (contentLength / 1024 / 1024).toFixed(2);
                    
                    if (contentLength > 0) {
                        log(`GitHub文件大小: ${sizeInMB} MB (${contentLength} bytes)`);
                        showResult(`✅ 文件大小正常: ${sizeInMB} MB`, 'success');
                        
                        if (sizeInMB < 0.1) {
                            showResult('⚠️ 文件可能太小，可能是空的或损坏的', 'warning');
                        }
                    } else {
                        log('文件大小为0，可能上传不完整');
                        showResult('❌ 文件大小为0，可能上传不完整', 'error');
                    }
                } else {
                    log(`无法获取文件大小: ${response.status}`);
                    showResult(`❌ 无法获取文件大小: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`文件大小检查错误: ${error.message}`);
                showResult(`❌ 文件大小检查错误: ${error.message}`, 'error');
            }
        }

        function getErrorMessage(code) {
            switch(code) {
                case 1: return 'MEDIA_ERR_ABORTED - 用户中止了加载';
                case 2: return 'MEDIA_ERR_NETWORK - 网络错误';
                case 3: return 'MEDIA_ERR_DECODE - 解码错误';
                case 4: return 'MEDIA_ERR_SRC_NOT_SUPPORTED - 不支持该格式';
                default: return '未知错误';
            }
        }

        // 页面加载时自动运行一些测试
        window.addEventListener('load', () => {
            log('调试页面已加载');
            log(`音频URL: ${audioUrl}`);
        });
    </script>
</body>
</html>