<!DOCTYPE html>
<html>
<head>
    <title>éŸ³é¢‘è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        button { margin: 5px; padding: 10px 15px; cursor: pointer; }
        #audioPlayer { width: 100%; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>ğŸµ GitHub Pages éŸ³é¢‘æ–‡ä»¶è°ƒè¯•å·¥å…·</h1>
    
    <div class="test-result">
        <strong>éŸ³é¢‘æ–‡ä»¶URL:</strong> <span id="audioUrl">https://trashbeatgod.github.io/MySite/music/backgroundmusic.mp3</span>
    </div>
    
    <button onclick="testAudioLoad()">æµ‹è¯•éŸ³é¢‘åŠ è½½</button>
    <button onclick="testDirectDownload()">æµ‹è¯•ç›´æ¥ä¸‹è½½</button>
    <button onclick="checkCORS()">æ£€æŸ¥CORS</button>
    <button onclick="checkFileSize()">æ£€æŸ¥æ–‡ä»¶å¤§å°</button>
    
    <div id="results"></div>
    
    <h3>éŸ³é¢‘æ’­æ”¾å™¨æµ‹è¯•:</h3>
    <audio id="audioPlayer" controls></audio>
    
    <h3>æ§åˆ¶å°æ—¥å¿—:</h3>
    <div id="consoleLog" style="background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; white-space: pre-wrap;"></div>

    <script>
        const audioUrl = 'https://trashbeatgod.github.io/MySite/music/backgroundmusic.mp3';
        const resultsDiv = document.getElementById('results');
        const consoleLog = document.getElementById('consoleLog');
        const audioPlayer = document.getElementById('audioPlayer');

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            consoleLog.textContent += logEntry;
            console.log(message);
        }

        function showResult(message, type) {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            resultsDiv.appendChild(div);
            log(message, type);
        }

        async function testAudioLoad() {
            resultsDiv.innerHTML = '';
            consoleLog.textContent = '';
            
            log('å¼€å§‹éŸ³é¢‘åŠ è½½æµ‹è¯•...');
            
            try {
                const audio = new Audio();
                audio.src = audioUrl;
                
                audio.addEventListener('loadstart', () => {
                    log('éŸ³é¢‘å¼€å§‹åŠ è½½...');
                });
                
                audio.addEventListener('loadedmetadata', () => {
                    log(`å…ƒæ•°æ®åŠ è½½æˆåŠŸ: æ—¶é•¿=${audio.duration}ç§’`);
                    showResult(`âœ… å…ƒæ•°æ®åŠ è½½æˆåŠŸï¼éŸ³é¢‘æ—¶é•¿: ${Math.round(audio.duration)}ç§’`, 'success');
                });
                
                audio.addEventListener('canplaythrough', () => {
                    log('éŸ³é¢‘å¯ä»¥å®Œæ•´æ’­æ”¾');
                    showResult('âœ… éŸ³é¢‘å¯ä»¥å®Œæ•´æ’­æ”¾ï¼', 'success');
                });
                
                audio.addEventListener('error', (e) => {
                    log(`éŸ³é¢‘åŠ è½½é”™è¯¯: ${audio.error.code} - ${audio.error.message}`);
                    showResult(`âŒ éŸ³é¢‘åŠ è½½é”™è¯¯: ${getErrorMessage(audio.error.code)}`, 'error');
                });
                
                audio.load();
                
                // è®¾ç½®æ’­æ”¾å™¨æº
                audioPlayer.src = audioUrl;
                
            } catch (error) {
                log(`æµ‹è¯•å¼‚å¸¸: ${error.message}`);
                showResult(`âŒ æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function testDirectDownload() {
            log('æµ‹è¯•ç›´æ¥ä¸‹è½½éŸ³é¢‘æ–‡ä»¶...');
            
            try {
                const response = await fetch(audioUrl, { method: 'HEAD' });
                
                if (response.ok) {
                    const contentLength = response.headers.get('content-length');
                    const contentType = response.headers.get('content-type');
                    const lastModified = response.headers.get('last-modified');
                    
                    log(`æ–‡ä»¶å¤§å°: ${contentLength} bytes`);
                    log(`å†…å®¹ç±»å‹: ${contentType}`);
                    log(`æœ€åä¿®æ”¹: ${lastModified}`);
                    
                    showResult(`âœ… æ–‡ä»¶å¯è®¿é—®ï¼<br>
                        å¤§å°: ${(contentLength / 1024 / 1024).toFixed(2)} MB<br>
                        ç±»å‹: ${contentType}<br>
                        ä¿®æ”¹æ—¶é—´: ${lastModified}`, 'success');
                } else {
                    log(`HTTPé”™è¯¯: ${response.status} ${response.statusText}`);
                    showResult(`âŒ HTTPé”™è¯¯: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                log(`ä¸‹è½½é”™è¯¯: ${error.message}`);
                showResult(`âŒ ä¸‹è½½é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function checkCORS() {
            log('æ£€æŸ¥CORSè®¾ç½®...');
            
            try {
                const response = await fetch(audioUrl, { 
                    method: 'GET',
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                const corsHeaders = [];
                for (let [key, value] of response.headers.entries()) {
                    if (key.toLowerCase().includes('access-control')) {
                        corsHeaders.push(`${key}: ${value}`);
                    }
                }
                
                if (corsHeaders.length > 0) {
                    log(`CORSå¤´ä¿¡æ¯: ${corsHeaders.join(', ')}`);
                    showResult(`âœ… CORSé…ç½®æ­£å¸¸<br>${corsHeaders.join('<br>')}`, 'success');
                } else {
                    log('æœªæ‰¾åˆ°CORSå¤´ä¿¡æ¯ï¼Œä½†è¿™åœ¨GitHub Pagesä¸Šæ˜¯æ­£å¸¸çš„');
                    showResult('â„¹ï¸ æœªæ‰¾åˆ°CORSå¤´ä¿¡æ¯ï¼ŒGitHub Pagesé€šå¸¸ä¸éœ€è¦ç‰¹æ®ŠCORSé…ç½®', 'warning');
                }
                
            } catch (error) {
                log(`CORSæ£€æŸ¥é”™è¯¯: ${error.message}`);
                showResult(`âŒ CORSæ£€æŸ¥é”™è¯¯: ${error.message}`, 'error');
            }
        }

        async function checkFileSize() {
            log('æ£€æŸ¥GitHubä¸Šçš„æ–‡ä»¶å¤§å°...');
            
            try {
                const response = await fetch(audioUrl, { method: 'HEAD' });
                
                if (response.ok) {
                    const contentLength = response.headers.get('content-length');
                    const sizeInMB = (contentLength / 1024 / 1024).toFixed(2);
                    
                    if (contentLength > 0) {
                        log(`GitHubæ–‡ä»¶å¤§å°: ${sizeInMB} MB (${contentLength} bytes)`);
                        showResult(`âœ… æ–‡ä»¶å¤§å°æ­£å¸¸: ${sizeInMB} MB`, 'success');
                        
                        if (sizeInMB < 0.1) {
                            showResult('âš ï¸ æ–‡ä»¶å¯èƒ½å¤ªå°ï¼Œå¯èƒ½æ˜¯ç©ºçš„æˆ–æŸåçš„', 'warning');
                        }
                    } else {
                        log('æ–‡ä»¶å¤§å°ä¸º0ï¼Œå¯èƒ½ä¸Šä¼ ä¸å®Œæ•´');
                        showResult('âŒ æ–‡ä»¶å¤§å°ä¸º0ï¼Œå¯èƒ½ä¸Šä¼ ä¸å®Œæ•´', 'error');
                    }
                } else {
                    log(`æ— æ³•è·å–æ–‡ä»¶å¤§å°: ${response.status}`);
                    showResult(`âŒ æ— æ³•è·å–æ–‡ä»¶å¤§å°: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`æ–‡ä»¶å¤§å°æ£€æŸ¥é”™è¯¯: ${error.message}`);
                showResult(`âŒ æ–‡ä»¶å¤§å°æ£€æŸ¥é”™è¯¯: ${error.message}`, 'error');
            }
        }

        function getErrorMessage(code) {
            switch(code) {
                case 1: return 'MEDIA_ERR_ABORTED - ç”¨æˆ·ä¸­æ­¢äº†åŠ è½½';
                case 2: return 'MEDIA_ERR_NETWORK - ç½‘ç»œé”™è¯¯';
                case 3: return 'MEDIA_ERR_DECODE - è§£ç é”™è¯¯';
                case 4: return 'MEDIA_ERR_SRC_NOT_SUPPORTED - ä¸æ”¯æŒè¯¥æ ¼å¼';
                default: return 'æœªçŸ¥é”™è¯¯';
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œä¸€äº›æµ‹è¯•
        window.addEventListener('load', () => {
            log('è°ƒè¯•é¡µé¢å·²åŠ è½½');
            log(`éŸ³é¢‘URL: ${audioUrl}`);
        });
    </script>
</body>
</html>